#!/bin/bash
set -e

POSTGRESQL_USER=${POSTGRESQL_USER:-"calcentral_development"}
POSTGRESQL_PASS=${POSTGRESQL_PASS:-"secret"}
POSTGRESQL_DB=${POSTGRESQL_DB:-"calcentral_development"}
POSTGRESQL_TEMPLATE=${POSTGRESQL_TEMPLATE:-"TEMPLATE0"}

POSTGRESQL_BIN=/usr/lib/postgresql/9.3/bin/postgres
POSTGRESQL_CONFIG_FILE=/etc/postgresql/9.3/main/postgresql.conf

POSTGRESQL_SINGLE="sudo -u postgres $POSTGRESQL_BIN --single --config-file=$POSTGRESQL_CONFIG_FILE"
$POSTGRESQL_SINGLE <<< "CREATE USER $POSTGRESQL_USER WITH SUPERUSER;" > /dev/null
$POSTGRESQL_SINGLE <<< "ALTER USER $POSTGRESQL_USER WITH PASSWORD '$POSTGRESQL_PASS';" > /dev/null
$POSTGRESQL_SINGLE <<< "CREATE DATABASE $POSTGRESQL_DB WITH ENCODING 'UTF8' OWNER $POSTGRESQL_USER TEMPLATE $POSTGRESQL_TEMPLATE;" > /dev/null

exec sudo -u postgres $POSTGRESQL_BIN --config-file=$POSTGRESQL_CONFIG_FILE -D $PGDATA


